define("quincy/promise",function(t,e){function n(t,e,n,r,i){setTimeout(function(){t(e,n,r,i)},4)}function r(t){t.call(this._bindTo,this.state)}function i(t){if(w.isObject(t)||w.isFunction(t)){var e=h(w.get,null,"then",t);if(e.failure)return e;if(w.isFunction(e.value))return e.value=e.value.bind(t),e}}function o(t,e){return t.state?void 0:(t.state=e,w.forEach(r,t._handlers,t),t._handlers=null,t)}function u(t,e,n,r){var o=r.fulfilled?e:n,u=r.fulfilled?"fulfill":"reject";if(!w.isFunction(o))return void j[u](t,r.value);var s=l(o,r.value,t._bindTo);if(s.failure)return void j.reject(t,s.cause);var f=s.value;if(void 0===f)return void j[u](t,r.value);if(t===f)return void j.reject(t,new TypeError("illegal state: promise cannot be resolved with itself"));var a=i(f);return a?void(a.success?c(a.value,t):j.reject(t,a.cause)):void j.fulfill(t,f)}function s(t,e,n,r){var i=r.fulfilled?e:n;if(r.rejected&&!i){if(!v.onerror)throw r.value;i=v.onerror}h(i,t._bindTo,r.value)}function c(t,e){try{t(function(t){j.fulfill(e,t)},function(t){j.reject(e,t)})}catch(n){j.reject(e,n)}}function l(t,e,n){return w.isFunction(t)?h(t,n,e):p(e)}function f(t,e){var n=i(e);return n?(n.success?c(n.value,t):a(t,n.cause),t):o(t,{fulfilled:!0,value:e})}function a(t,e){return o(t,{rejected:!0,value:e})}function h(t,e){for(var n=[],r=0,i=2,o=arguments.length;o>i;r++,i++)n[r]=arguments[i];try{return p(t.apply(e,n))}catch(u){return d(u)}}function p(t){return{success:!0,value:t}}function d(t){return{failure:!0,cause:t}}function v(t){if(void 0!==t&&!w.isFunction(t))throw new TypeError("promise resolver must be a function");this._handlers=[];var e=this;if(t)try{t(function(t){j.fulfill(e,t)},function(t){j.reject(e,t)})}catch(n){j.reject(this,n)}}function y(t,e){return t._bindTo=e,t}function m(){this.promise=new v}var w=t("quincy"),j={fulfill:f,reject:a};v.prototype._addHandler=function(t){this._handlers.push(t)},v.prototype._then=function(t,e,r,i){return t._bindTo||(t._bindTo=this._bindTo),this.isSettled()?n(e,t,r,i,this.state):this._addHandler(function(n){e(t,r,i,n)}),t},v.prototype.isSettled=function(){return w.isSome(this.state)},v.prototype.isPending=function(){return!this.state},v.prototype.isFulfilled=function(){return w.isSome(this.state)&&this.state.fulfilled===!0},v.prototype.isRejected=function(){return w.isSome(this.state)&&this.state.rejected===!0},v.prototype.value=function(){if(!this.isFulfilled())throw Error("cannot get value from unfulfilled promise");return this.state.value},v.prototype.reason=function(){if(!this.isRejected())throw Error("cannot get reason from unrejected promise");return this.state.value},v.prototype.then=function(t,e){return this._then(new v,u,t,e)},v.prototype["catch"]=function(t){return this.then(void 0,t)},v.prototype.peek=function(t){return this.then(function(e){h(t,this,e)},function(e){h(t,this,e)})},v.prototype.always=function(t){return this.then(t,t)},v.prototype["finally"]=function(t){this.done(t,t)},v.prototype.done=function(t,e){this._then(new v,s,t,e)},v.prototype.bind=function(t){return this._then(y(new v,t),u)},v.prototype.spread=function(t,e){return this.then(function(e){var n=e;return w.isArray(n)||(n=[e]),t.apply(void 0,n)},e)},v.prototype.collect=function(t,e){return this.then(function(n){if(!t(n))throw new Error("no such promise value");return e(n)})},v.prototype.filter=function(t){return this.collect(t,w.identity)},v.prototype.map=function(t){return this.collect(w.always,t)},v.prototype.recover=function(t){return this["catch"](function(e){var n=t(e);if(void 0===n)throw e;return n})},v.resolve=function(t){return j.fulfill(new v,t)},v.reject=function(t){return j.reject(new v,t)},v["try"]=function(){var t=new v,e=h.apply(null,arguments);return e.success?f(t,e.value):a(t,e.cause),t},v.all=function(t){if(!w.isIterable(t)||w.isEmpty(t))throw new TypeError("Promise.all: non-empty iterable required");return new v(function(e,n){function r(t,e,n){t.results[e]=n,0===--t.remaining&&t.resolve(t.results)}var i={remaining:t.length,results:[],resolve:e,reject:n};return 0===i.remaining?void i.resolve(i.results):void w.forEach(function(t,e){if(v.is(t)){var n=this;t.then(function(t){r(n,e,t)},this.reject)}else r(this,e,t)},t,i)})},v.race=function(t){if(!w.isIterable(t)||w.isEmpty(t))throw new TypeError("Promise.race: non-empty iterable required");return new v(function(e,n){w.forEach(function(t){v.is(t)?t.then(e)["catch"](n):e(t)},t,this)})},v.is=function(t){return w.isSome(t)&&w.isFunction(t.then)},m.prototype.resolve=function(t){this.isCompleted()||j.fulfill(this.promise,t)},m.prototype.reject=function(t){this.isCompleted()||j.reject(this.promise,t)},m.prototype.isCompleted=function(){return this.promise.isSettled()},v.defer=function(){return new m},e.exports=v});